(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{72816:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(95155),a=t(12115),l=t(35695),n=t(82885),d=t(88304),i=t(39040);function c(){let e=(0,l.useRouter)(),{user:s,isInGroup:t,loading:c,userGroups:o}=(0,d.A)(),[x,m]=(0,a.useState)("reservations"),[h,p]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[b,j]=(0,a.useState)([]),[N,y]=(0,a.useState)(!0),[v,f]=(0,a.useState)({todayReservations:0,activeOrders:0,totalMembers:0,todayRevenue:0});(0,a.useEffect)(()=>{c||s?c||!s||t("restaurantHost")||t("maintenance")||e.push("/"):e.push("/login")},[c,s,t,e]),(0,a.useEffect)(()=>{if(s&&(t("restaurantHost")||t("maintenance")))return console.log("User authenticated, fetching data..."),console.log("User groups:",o),w(),O()},[s]);let w=async()=>{y(!0);try{await Promise.all([S(),D(),E()])}catch(e){console.error("Error fetching data:",e),e instanceof Error&&(console.error("Error message:",e.message),console.error("Error stack:",e.stack)),alert("Error loading data. Please check the console for details.")}finally{y(!1)}},S=async()=>{try{console.log("Fetching reservations...");let e=await i.S.models.Reservation.list();console.log("Full reservation response:",e),e.errors&&e.errors.length>0&&(console.error("GraphQL errors:",e.errors),e.errors.forEach(e=>{console.error("Error detail:",e)}));let s=e.data;console.log("Reservations fetched:",s),p(s||[]);let t=new Date().toISOString().split("T")[0],r=(null==s?void 0:s.filter(e=>e.date===t))||[];f(e=>({...e,todayReservations:r.length}))}catch(e){throw console.error("Error fetching reservations:",e),e instanceof Error&&console.error("Error details:",{message:e.message,name:e.name,stack:e.stack}),e}},D=async()=>{try{console.log("Fetching orders...");let e=await i.S.models.Order.list();console.log("Orders response:",e);let s=e.data;g(s||[]);let t=(null==s?void 0:s.filter(e=>"pending"===e.status||"confirmed"===e.status||"preparing"===e.status||"delivering"===e.status))||[],r=new Date().toISOString().split("T")[0],a=((null==s?void 0:s.filter(e=>{var s;return null==(s=e.createdAt)?void 0:s.startsWith(r)}))||[]).reduce((e,s)=>e+(s.total||0),0);f(e=>({...e,activeOrders:t.length,todayRevenue:a}))}catch(e){console.error("Error fetching orders:",e)}},E=async()=>{try{console.log("Fetching members...");let e=await i.S.models.User.list();console.log("Members response:",e);let s=e.data;j(s||[]),f(e=>({...e,totalMembers:(null==s?void 0:s.length)||0}))}catch(e){console.error("Error fetching members:",e)}},O=()=>{let e=i.S.models.Reservation.observeQuery().subscribe({next:e=>{let{items:s}=e;p(s);let t=new Date().toISOString().split("T")[0],r=s.filter(e=>e.date===t);f(e=>({...e,todayReservations:r.length}))}}),s=i.S.models.Order.observeQuery().subscribe({next:e=>{let{items:s}=e;g(s);let t=s.filter(e=>"pending"===e.status||"confirmed"===e.status||"preparing"===e.status||"delivering"===e.status);f(e=>({...e,activeOrders:t.length}))}});return()=>{e.unsubscribe(),s.unsubscribe()}},R=async(e,s)=>{try{await i.S.models.Reservation.update({id:e,status:s})}catch(e){console.error("Error updating reservation:",e),alert("Failed to update reservation status")}},C=async(e,s)=>{try{await i.S.models.Order.update({id:e,status:s})}catch(e){console.error("Error updating order:",e),alert("Failed to update order status")}};return c?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-900 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):s&&(t("restaurantHost")||t("maintenance"))?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-red-900 to-red-700 py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Restaurant Host Dashboard"}),(0,r.jsx)("p",{className:"text-gold mt-2",children:"Manage reservations, orders, and members"}),(0,r.jsxs)("div",{className:"mt-4 text-sm text-white opacity-90",children:["Role: ",o.join(", ")]})]})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDCC5"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Reservations"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-red-900 mt-2",children:v.todayReservations})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDED2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Active Orders"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-red-900 mt-2",children:v.activeOrders})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDC65"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Members"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-red-900 mt-2",children:v.totalMembers})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDCB0"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Revenue"}),(0,r.jsxs)("p",{className:"text-3xl font-bold text-red-900 mt-2",children:["$",v.todayRevenue.toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,r.jsx)("div",{className:"border-b",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsxs)("button",{onClick:()=>m("reservations"),className:"px-6 py-3 font-semibold transition ".concat("reservations"===x?"text-red-900 border-b-2 border-red-900":"text-gray-600 hover:text-red-900"),children:["Reservations (",h.length,")"]}),(0,r.jsxs)("button",{onClick:()=>m("orders"),className:"px-6 py-3 font-semibold transition ".concat("orders"===x?"text-red-900 border-b-2 border-red-900":"text-gray-600 hover:text-red-900"),children:["Orders (",u.length,")"]}),(0,r.jsxs)("button",{onClick:()=>m("members"),className:"px-6 py-3 font-semibold transition ".concat("members"===x?"text-red-900 border-b-2 border-red-900":"text-gray-600 hover:text-red-900"),children:["Members (",b.length,")"]})]})}),(0,r.jsx)("div",{className:"p-6",children:N?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-900 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading data..."})]}):(0,r.jsxs)(r.Fragment,{children:["reservations"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-900 mb-4",children:"Manage Reservations"}),0===h.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No reservations yet"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Customer"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Date"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Time"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Guests"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Status"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:h.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold",children:e.customerName}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),e.phone&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.phone})]})}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.date}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.time}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.numberOfGuests}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-sm font-semibold ".concat("confirmed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})}),(0,r.jsxs)("td",{className:"py-3 px-4",children:["pending"===e.status&&(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>e.id&&R(e.id,"confirmed"),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"Confirm"}),(0,r.jsx)("button",{onClick:()=>e.id&&R(e.id,"cancelled"),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",children:"Cancel"})]}),e.specialRequests&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Note: ",e.specialRequests]})]})]},e.id))})]})})]}),"orders"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-900 mb-4",children:"Manage Orders"}),0===u.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No orders yet"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Order ID"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Customer"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Time"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Total"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Status"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:u.map(e=>{var s,t,a;return(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"py-3 px-4",children:["#",(null==(s=e.id)?void 0:s.slice(-8))||"N/A"]}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold",children:e.customerName}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.phone}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.deliveryAddress})]})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(a=e.createdAt)?new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}),(0,r.jsxs)("td",{className:"py-3 px-4",children:["$",null==(t=e.total)?void 0:t.toFixed(2)]}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-sm font-semibold ".concat("delivered"===e.status?"bg-green-100 text-green-800":"preparing"===e.status?"bg-blue-100 text-blue-800":"delivering"===e.status?"bg-purple-100 text-purple-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})}),(0,r.jsxs)("td",{className:"py-3 px-4",children:[(0,r.jsxs)("select",{value:e.status||"pending",onChange:s=>e.id&&C(e.id,s.target.value),className:"border rounded px-2 py-1 text-sm",children:[(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,r.jsx)("option",{value:"preparing",children:"Preparing"}),(0,r.jsx)("option",{value:"delivering",children:"Delivering"}),(0,r.jsx)("option",{value:"delivered",children:"Delivered"}),(0,r.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),e.specialInstructions&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Note: ",e.specialInstructions]})]})]},e.id)})})]})})]}),"members"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-900 mb-4",children:"Member Management"}),0===b.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No members yet"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Name"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Email"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Role"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Total Orders"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Loyalty Points"}),(0,r.jsx)("th",{className:"text-left py-2 px-4",children:"Member Since"})]})}),(0,r.jsx)("tbody",{children:b.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:e.name||"N/A"}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.email}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-sm font-semibold ".concat("maintenance"===e.role?"bg-purple-100 text-purple-800":"restaurantHost"===e.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.role||"customer"})}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.totalOrders||0}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.loyaltyPoints||0}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.memberSince?new Date(e.memberSince).toLocaleDateString():"N/A"})]},e.id))})]})})]})]})})]})]})]}):null}},93758:(e,s,t)=>{Promise.resolve().then(t.bind(t,72816))}},e=>{e.O(0,[218,244,718,232,124,441,964,358],()=>e(e.s=93758)),_N_E=e.O()}]);